# Blind Sync 仕様書

（相性計測対話システム）

---

## 1. システム概要

Blind Sync は、4 人の参加者を対象に  
MBTI に基づく初期相性と、価値観質問への回答結果を組み合わせて  
相性スコアを算出・可視化する Web アプリケーションである。

本システムは以下の特徴を持つ。

- フレームワーク非依存（Vanilla JavaScript）
- 状態管理は localStorage のみで完結
- データ定義はすべて JSON ベース
- サーバサイド処理は行わない（静的 Web アプリ）

---

## 2. 全体構成と画面遷移

### 2.1 画面構成

| 画面       | ファイル       | 役割                     |
| ---------- | -------------- | ------------------------ |
| 参加者登録 | entry.html     | 参加者情報の入力         |
| 質問回答   | questions.html | 価値観質問への回答       |
| 結果表示   | result.html    | 相性計算・ランキング表示 |

### 2.2 画面遷移

```
entry.html
  ↓（4人登録完了）
questions.html
  ↓（全員4問回答完了）
result.html
```

---

## 3. データ管理仕様

### 3.1 localStorage 一覧

| キー         | 内容                     |
| ------------ | ------------------------ |
| participants | 参加者情報               |
| answers      | 質問回答データ           |
| questions    | 抽選された質問（表示用） |

---

### 3.2 participants（参加者情報）

```json
[{ "id": 1, "name": "yushiro", "mbti": "ISFP", "drink": "beer" }]
```

| フィールド | 型     | 説明                 |
| ---------- | ------ | -------------------- |
| id         | number | 登録順 ID（1〜4）    |
| name       | string | ニックネーム         |
| mbti       | string | MBTI（大文字正規化） |
| drink      | string | 好きなお酒           |

---

### 3.3 answers（質問回答）

```json
{
  "money": [[0, 1, 2, 3]]
}
```

- カテゴリごとに配列を持つ
- 各配列の要素は「1 問分」
- 内部配列は `[参加者0,1,2,3]` の回答インデックス

---

## 4. JSON データ仕様

### 4.1 questions.json

| フィールド | 説明         |
| ---------- | ------------ |
| id         | 質問識別子   |
| text       | 質問文       |
| options    | 4 択の選択肢 |

---

### 4.2 initial_scores/\*.json

| フィールド | 説明                       |
| ---------- | -------------------------- |
| category   | カテゴリ名                 |
| scores     | MBTI × MBTI 初期相性スコア |

---

### 4.3 advice.json

- キー形式：`MBTI_A_MBTI_B`（アルファベット順）
- 値：組み合わせ別アドバイス文

---

## 5. 機能別仕様

---

## 5.1 参加者登録機能（entry.js）

### 役割

- 4 人分の参加者情報を入力・保存
- チャット UI による入力誘導
- 入力途中の再開を可能にする

### 主な関数

| 関数名           | 概要                           |
| ---------------- | ------------------------------ |
| addMsg           | チャット画面にメッセージを追加 |
| setSelectOptions | セレクトボックス生成           |
| handleNext       | 入力検証・保存・画面遷移       |

---

## 5.2 質問回答機能（questions.js）

### 役割

- 各カテゴリから 1 問ずつランダム抽選
- 参加者が 4 問連続で回答
- 回答結果を localStorage に保存

### 主な関数

| 関数名         | 概要                 |
| -------------- | -------------------- |
| pickOneRandom  | 配列からランダム抽選 |
| renderScreen   | 質問画面描画         |
| onChooseOption | 回答保存・状態遷移   |

---

## 5.3 相性計算・結果表示（result.js）

### 役割

- 6 ペアの自動生成
- 相性スコア算出
- ランキング・アドバイス表示

### スコア計算式

```
相性スコア
= Σ（カテゴリ別初期相性）
+（質問一致数 × 5）
```

### 主な関数

| 関数名        | 概要           |
| ------------- | -------------- |
| generatePairs | ペア生成       |
| countMatches  | 回答一致数算出 |
| calculate     | スコア計算     |
| renderResults | 結果描画       |

---

## 6. 非機能要件

- フレームワーク非使用
- サーバ通信なし
- ローカル実行のみ
- データ永続化は localStorage のみ

---

## 7. 拡張予定（仕様外）

- お酒の嗜好による加点
- スコア正規化
- 質問数の増加
- モバイル対応

---

## 8. まとめ

本仕様書は、Blind Sync の内部構造および  
データ設計・処理フローを明確に示すことを目的とする。

取扱説明書と分離することで、  
利用者視点と開発者視点を明確に区別した設計となっている。
